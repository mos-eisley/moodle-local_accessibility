{"version":3,"file":"colourwidget.min.js","sources":["../src/colourwidget.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Default script for colourpicker widgets\n *\n * @module      local/accessibility\n * @copyright   2023 Ponlawat Weerapanpisit <ponlawat_w@outlook.co.th>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {saveWidgetConfig} from './common';\nimport $ from 'jquery';\n\n/**\n * Function to initialise a colour-picker widget\n * @param {string} widget plugin full name\n * @param {string} savewidgetname widget name to be saved as user config\n * @param {string} stylename css attribute name to be applied the colour value\n * @param {string} bodyclassname class name of default value in body tag\n * @param {string} selector css selector of affected elements\n */\nexport const init = (widget, savewidgetname, stylename, bodyclassname = undefined, selector = 'body, body *') => {\n    $(() => {\n        const revokedefault = () => {\n            if (bodyclassname) {\n                $('body').removeClass(bodyclassname);\n            }\n        };\n\n        const defaultattrname = `data-default-${stylename}`;\n        const $container = $(`#${widget}-container`);\n        if (!$container.length) {\n            return;\n        }\n\n        const $picker = $container.find(`#${widget}-picker`);\n        if (!$picker.length) {\n            return;\n        }\n        $picker.on('change input propertychange', async() => {\n            const colour = $picker.val();\n            if (!colour) {\n                return;\n            }\n            if (!/#[0-9a-f]{6}/gi.exec(colour)) {\n                return;\n            }\n            revokedefault();\n            for (const $element of [...$(selector)].map(e => $(e))) {\n                if (!$element.attr(defaultattrname)) {\n                    $element.attr(defaultattrname, $element.css(stylename));\n                }\n                $element.css(stylename, colour);\n            }\n            await saveWidgetConfig(savewidgetname, colour);\n        });\n\n        const $img = $container.find('img.colourdialogue');\n        if ($img.length) {\n            $img.on('click', () => {\n                $picker.trigger('change');\n            });\n        }\n\n        const $resetbtn = $container.find(`.${widget}-resetbtn`);\n        if ($resetbtn.length) {\n            $resetbtn.on('click', async() => {\n                $picker.val('');\n                revokedefault();\n                for (const element of [...$(selector)]) {\n                    const $element = $(element);\n                    const defaultcolour = $element.attr(defaultattrname) ?? '';\n                    $element.css(stylename, defaultcolour);\n                    $element.removeAttr(defaultattrname);\n                }\n                await saveWidgetConfig(savewidgetname, null);\n            });\n        }\n    });\n};\n"],"names":["e","_jquery","__esModule","default","_exports","init","widget","savewidgetname","stylename","bodyclassname","arguments","length","undefined","selector","$","revokedefault","removeClass","defaultattrname","$container","$picker","find","on","async","colour","val","exec","$element","map","attr","css","saveWidgetConfig","$img","trigger","$resetbtn","element","defaultcolour","removeAttr"],"mappings":"8GAwBuB,IAAAA;;;;;;;kFAAvBC,SAAuBD,EAAvBC,UAAuBD,EAAAE,WAAAF,EAAAG,CAAAA,QAAAH,GAoErBI,SAAAC,KA1DkB,SAACC,OAAQC,eAAgBC,WAAoE,IAAzDC,cAAaC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,QAAGE,EAAWC,SAAQH,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,gBAC1F,EAAAI,QAAAA,UAAE,KACE,MAAMC,cAAgBA,KACdN,gBACA,EAAAK,QAAAA,SAAE,QAAQE,YAAYP,cAC1B,EAGEQ,gBAAkB,gBAAgBT,YAClCU,YAAa,EAAAJ,QAAAA,SAAE,IAAIR,oBACzB,IAAKY,WAAWP,OACZ,OAGJ,MAAMQ,QAAUD,WAAWE,KAAK,IAAId,iBACpC,IAAKa,QAAQR,OACT,OAEJQ,QAAQE,GAAG,+BAA+BC,UACtC,MAAMC,OAASJ,QAAQK,MACvB,GAAKD,QAGA,iBAAiBE,KAAKF,QAA3B,CAGAR,gBACA,IAAK,MAAMW,WAAY,KAAI,EAAAZ,QAAAA,SAAED,WAAWc,KAAI3B,IAAK,EAAAc,iBAAEd,KAC1C0B,SAASE,KAAKX,kBACfS,SAASE,KAAKX,gBAAiBS,SAASG,IAAIrB,YAEhDkB,SAASG,IAAIrB,UAAWe,cAEtB,EAAAO,QAAgBA,kBAACvB,eAAgBgB,OARvC,CAQ8C,IAGlD,MAAMQ,KAAOb,WAAWE,KAAK,sBACzBW,KAAKpB,QACLoB,KAAKV,GAAG,SAAS,KACbF,QAAQa,QAAQ,SAAS,IAIjC,MAAMC,UAAYf,WAAWE,KAAK,IAAId,mBAClC2B,UAAUtB,QACVsB,UAAUZ,GAAG,SAASC,UAClBH,QAAQK,IAAI,IACZT,gBACA,IAAK,MAAMmB,UAAW,KAAI,EAAApB,QAAAA,SAAED,WAAY,CACpC,MAAMa,UAAW,EAAAZ,QAACX,SAAC+B,SACbC,cAAgBT,SAASE,KAAKX,kBAAoB,GACxDS,SAASG,IAAIrB,UAAW2B,eACxBT,SAASU,WAAWnB,gBACxB,OACM,EAAAa,QAAgBA,kBAACvB,eAAgB,KAAK,GAEpD,IAEN"}